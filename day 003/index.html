<!-- 
Buat sebuah aplikasi Book Store menggunakan html dengan prompt dan alert. Tampilkan menu dengan pilihan menu :
1. Daftar Buku (dapat memilih buku untuk dibeli. Terdapat stock jumlah buku yang tersedia serta harga buku tersebut dan dapat menginput berapa banyak buku yang ingin dibeli)
2. Keranjang Belanja (dapat menghapus buku yang ada di keranjang dan mengedit quantity bukunya. Qty buku yg terdapat di keranjang belum menghapus jumlah stock yg ada pada daftar buku tetapi tidak boleh melebihi jumlah stock)
3. Payment ( menampilkan semua jenis ,quantity, dan harga dari buku yg di keranjang. Dan user harus menginput uang sesuai dengan total dari harga bukunya. Apa bila kurang maka tidak berhasil membayar. Bila uang kelebihan maka akan menampillan kembalian dari uang si user)
4. Exit (keluar dari menu yang ditampilkan. Menu akan selalu dilooping selama user tidak memilih untuk exit)
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Store</title>
    <script async>
      let bookPrice = 11000;
      let priceTagline = `[ Rp11k untuk semua jenis buku ]`;
      let userCart = [];
      let avalInvts = [
        ["Web Dev Module", 16],
        ["Data Science Module", 32],
        ["UI/UX Module", 10],
        ["Digital Marketing Module", 12],
      ];
      const checkMatch = (array, input) => {
        let result = array.find(
          (val, idx) =>
            input == idx + 1 || input.toLowerCase() == val[0].toLowerCase()
        );
        return result;
      };
      const loopOrBack = (input, index) => {
        input ? mainMenu[index][1]() : main();
      };
      const numToIDR = (number) =>
        `Rp${number.toLocaleString().replace(/,/g, ".")},00`;
      const bookList = () => {
        let bookToBuy = prompt(
          `-- ${mainMenu[0][0]} --\n${priceTagline}${avalInvts.map(
            (invt, idx) => `\n    (${idx + 1}) {Qty: ${invt[1]}} ${invt[0]}`
          )}\n-- Masukan nomor atau judul buku --`
        );
        let bookInInvts = checkMatch(avalInvts, bookToBuy);
        if (bookInInvts) {
          const checkBookIdx = (invt) => invt[0] == bookInInvts[0];
          let sameBookIdx = userCart.findIndex(checkBookIdx);
          let sameBookQty = sameBookIdx >= 0 ? userCart[sameBookIdx][1] : 0;
          const askBookQty = () => {
            let buyQty = Number(
              prompt(
                `    ${bookInInvts[0]}\n    {Cart.Qty: ${sameBookQty}} {Aval.Qty: ${bookInInvts[1]}}\n-- Masukan jumlah beli sesuai dengan ketersediaan buku --`
              )
            );
            if (buyQty > bookInInvts[1] - sameBookQty || isNaN(buyQty)) {
              askBookQty();
            } else {
              sameBookQty
                ? (userCart[sameBookIdx][1] += buyQty)
                : userCart.push([bookInInvts[0], buyQty]);
            }
          };
          askBookQty();
        }
        loopOrBack(bookToBuy, 0);
      };
      const shopCart = () => {
        let cartEdit = prompt(`-- ${mainMenu[1][0]} --\n-- --`);

        loopOrBack(cartEdit, 1);
      };
      const bookCheckout = () => {
        let cartList = "";
        let totalPrice = 0;
        if (userCart[0]) {
          userCart.map((item) => {
            cartList += `\n    ( ) {Qty: ${item[1]}} ${item[0]}`;
            totalPrice += item[1] * bookPrice;
          });
          cartList += `\n-- Total: ${numToIDR(totalPrice)} --`;
        }
        let payProcess = prompt(
          `-- ${mainMenu[2][0]} --\n${priceTagline}${cartList}`
        );
        if (cartList && payProcess.replace(/Rp/gi, "") >= totalPrice) {
          alert(
            `Terima kasih atas pembeliannya!${
              payProcess > totalPrice
                ? `\nKembalian Anda: ${numToIDR(payProcess - totalPrice)}`
                : ""
            }`
          );
          avalInvts.map((invt, idx) => {
            let soldItem = userCart.find((item) => item[0] == invt[0]);
            soldItem && (avalInvts[idx][1] -= soldItem[1]);
          });
          userCart = [];
          cartHistory = [];
          cartList = "";
          totalPrice = 0;
          main();
        }
        loopOrBack(payProcess, 2);
      };
      const exitStore = () => {
        alert(`Kami menantikan langganan Anda selanjutnya!`);
      };
      let mainMenu = [
        ["Daftar Buku", bookList],
        ["Keranjang Buku", shopCart],
        ["Payment", bookCheckout],
        ["Exit", exitStore],
      ];
      const main = () => {
        let menuSel = prompt(
          `-- Book Store --${mainMenu.map(
            (menuItem, idx) => `\n    (${idx + 1}) ${menuItem[0]}`
          )}\n-- Masukan nomor atau nama tujuan Anda --`
        );
        let selMatch = checkMatch(mainMenu, menuSel);
        selMatch ? selMatch[1]() : main();
        // const bookList = () => {
        //   let bookToBuy = prompt(
        //     `${mainMenu[0]}${avalBSPs.map(
        //       (BSP, idx) => `\n(${idx + 1}) [Rp##k] {Qty: ${BSP[1]}} ${BSP[2]}`
        //     )}`
        //   );
        //   if (validateInput(avalBSPs, bookToBuy)) {
        //     let bookChosen = avalBSPs[bookToBuy];
        //   } else {
        //     bookList();
        //   }
        // };
        // if (menuSel == 1 || menuSel == /daftar buku/i) {
        //   bookList();
        // } else if (menuSel == 2 || menuSel == /keranjang belanja/i) {
        //   shopCart();
        // } else if (menuSel == 3 || menuSel == /payment/i) {
        //   payment();
        // } else if (menuSel == 4 || menuSel == /exit/i) {
        // } else {
        //   main();
        // }
      };
      main();
    </script>
  </head>
  <body>
    <button onclick="main()">Open Menu</button>
  </body>
</html>
